## π“ λΌμ¦λ² λ¦¬νμ΄5 μΉ΄λ©”λΌ μ„¤μ • λ° μ¶λ ¥ ν…μ¤νΈ κ°€μ΄λ“

### 1. λΌμ¦λ² λ¦¬νμ΄5 μ„¤μ • λ° μΉ΄λ©”λΌ μ—°κ²°

#### 1-1. μ΄μμ²΄μ  μ„¤μ •
λΌμ¦λ² λ¦¬νμ΄5λ” **Bookworm OS**λ§ μ§€μ›ν•λ©°, μ΄μ „ λ²„μ „μ OSλ” νΈν™λμ§€ μ•λ”λ‹¤. κΈ°μ΅΄μ— μ‚¬μ©λλ **Picamera λΌμ΄λΈλ¬λ¦¬**λ” Bookworm OSμ—μ„ λ” μ΄μƒ μ§€μ›λμ§€ μ•μΌλ―€λ΅, λ€μ‹  **libcamera λΌμ΄λΈλ¬λ¦¬**λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•λ‹¤.

#### 1-2. config.txt νμΌ μ„¤μ •

λΌμ¦λ² λ¦¬νμ΄5λ” μµλ€ 2κ°μ μΉ΄λ©”λΌλ¥Ό μ—°κ²°ν•  μ μλ‹¤. **config.txt νμΌ μμ •μ€ μ—°κ²°λ μΉ΄λ©”λΌμ μΉ©μ…‹μ„ μΈμ‹ν•κ³  ν™μ„±ν™”ν•κΈ° μ„ν•΄ λ°λ“μ‹ ν•„μ”ν•λ‹¤.**

μ‚¬μ© μ¤‘μΈ μΉ΄λ©”λΌμ μΉ©μ…‹ μ •λ³΄λ¥Ό ν™•μΈν• ν›„, ν•΄λ‹Ή μΉ©μ…‹μ— λ§κ² `dtoverlay` μ„¤μ •μ„ μ¶”κ°€ν•΄μ•Ό ν•λ‹¤. μλ¥Ό λ“¤μ–΄, imx219 μΉ©μ…‹μ„ μ‚¬μ©ν•λ” κ²½μ° λ‹¤μκ³Ό κ°™μ€ μ„¤μ •μ„ μ¶”κ°€ν•λ‹¤:

```bash
sudo nano /boot/firmware/config.txt
```

```bash
dtoverlay=imx219,cam0
dtoverlay=imx219,cam1
```

λ‹¤λ¥Έ μΉ©μ…‹μ„ μ‚¬μ©ν•λ” κ²½μ°μ—λ„ κ°™μ€ λ°©μ‹μΌλ΅ μ„¤μ •μ„ μ¶”κ°€ν•λ©΄ λλ‹¤. μλ¥Ό λ“¤μ–΄ OV5647 μΉ©μ…‹μ κ²½μ°:

```bash
dtoverlay=ov5647,cam0
```

**μ΄ μ„¤μ •μ€ μΉ©μ…‹ μΆ…λ¥μ— λ”°λΌ λ‹¬λΌμ§€λ―€λ΅, μ‚¬μ©μκ°€ μ‚¬μ©ν•λ” μΉ΄λ©”λΌμ μΉ©μ…‹μ„ ν™•μΈν•λ” κ²ƒμ΄ μ¤‘μ”ν•λ‹¤.**

---

### 2. μΉ΄λ©”λΌ μ‚¬μ© ν…μ¤νΈ (libcamera λΌμ΄λΈλ¬λ¦¬)

#### 2-1. μΉ΄λ©”λΌ μΉ©μ…‹ μ •λ³΄ ν™•μΈ

μΉ΄λ©”λΌκ°€ μ‚¬μ©ν•λ” μΉ©μ…‹μ„ ν™•μΈν•λ ¤λ©΄ λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•λ‹¤:
```bash
libcamera-hello --list-cameras
```
λλ”
```bash
libcamera-vid --list-cameras
```

μ΄ λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•λ©΄ ν„μ¬ μ—°κ²°λ μΉ΄λ©”λΌμ μΉ©μ…‹ μ •λ³΄κ°€ μ¶λ ¥λλ‹¤. μ΄λ¥Ό ν†µν•΄ μ‚¬μ© μ¤‘μΈ μΉ΄λ©”λΌκ°€ μ–΄λ–¤ μΉ©μ…‹μ„ μ‚¬μ©ν•λ”μ§€ ν™•μΈν•κ³ , config.txt νμΌμ„ μ¬λ°”λ¥΄κ² μ„¤μ •ν•  μ μλ‹¤.

---

#### 2-2. μΉ΄λ©”λΌ ν™”λ©΄ μ¶λ ¥ μ½”λ“

μ΄ μ½”λ“μ λ©μ μ€ μ—°κ²°λ μΉ΄λ©”λΌμ μμƒμ„ μ¤νΈλ¦¬λ°ν•μ—¬ ν™”λ©΄μ— μ¶λ ¥ν•λ” κ²ƒμ΄λ‹¤. κ° μ½”λ“μ κΈ°λ¥μ„ ν•λ‚ν•λ‚ μ„¤λ…ν•λ‹¤.

1. **ν•„μ”ν• λΌμ΄λΈλ¬λ¦¬ λ¶λ¬μ¤κΈ°:**
```python
import cv2
import numpy as np
import subprocess
import shlex
```
- `cv2`: OpenCV λΌμ΄λΈλ¬λ¦¬λ΅, μμƒ μ²λ¦¬λ¥Ό λ‹΄λ‹Ήν•λ‹¤.
- `numpy`: μ΄λ―Έμ§€ λ°μ΄ν„°λ¥Ό λ°°μ—΄λ΅ λ³€ν™ν•κ³  μ²λ¦¬ν•λ” λ° μ‚¬μ©λλ‹¤.
- `subprocess`: ν„°λ―Έλ„ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•κΈ° μ„ν•΄ μ‚¬μ©λλ‹¤.
- `shlex`: λ…λ Ήμ–΄λ¥Ό μ•μ „ν•κ² λ¶„λ¦¬ν•κΈ° μ„ν•΄ μ‚¬μ©λλ‹¤.

2. **μΉ΄λ©”λΌ μΉ©μ…‹ μ •λ³΄ ν™•μΈν•κΈ°:**
```python
result = subprocess.run(['libcamera', 'list'], capture_output=True, text=True)
print('μΉ΄λ©”λΌ μ •λ³΄:')
print(result.stdout)
```
- `libcamera list` λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ—¬ μ—°κ²°λ μΉ΄λ©”λΌμ μ •λ³΄λ¥Ό μ¶λ ¥ν•λ‹¤.
- `result.stdout`μ—λ” μΉ΄λ©”λΌ μΉ©μ…‹ μ •λ³΄κ°€ ν…μ¤νΈ ν•νƒλ΅ μ €μ¥λλ‹¤.

3. **μΉ΄λ©”λΌ μμƒ μ¤νΈλ¦¬λ° λ…λ Ήμ–΄ μ„¤μ •:**
```python
cmd = 'libcamera-vid --inline --nopreview -t 0 --codec mjpeg --width 640 --height 480 --framerate 30 -o - --camera 0'
```
- μΉ΄λ©”λΌ μ¤νΈλ¦¬λ°μ„ μ„ν• λ…λ Ήμ–΄λ¥Ό μ •μν•λ‹¤.
- `--width`μ™€ `--height`λ” μμƒμ ν•΄μƒλ„λ¥Ό μ„¤μ •ν•λ‹¤.
- `--framerate`λ” μ΄λ‹Ή ν”„λ μ„ μλ¥Ό μλ―Έν•λ‹¤.
- `--camera 0`μ€ μ²« λ²μ§Έ μΉ΄λ©”λΌλ¥Ό μ‚¬μ©ν•λ„λ΅ μ§€μ •ν•λ‹¤.

4. **μΉ΄λ©”λΌ μ¤νΈλ¦¬λ° ν”„λ΅μ„Έμ¤ μ‹μ‘:**
```python
process = subprocess.Popen(shlex.split(cmd), stdout=subprocess.PIPE, stderr=subprocess.PIPE)
```
- `subprocess.Popen`μ„ μ΄μ©ν•μ—¬ μ„¤μ •λ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ‹¤.
- μ¶λ ¥ μμƒ λ°μ΄ν„°λ¥Ό νμ΄ν”„ ν•νƒλ΅ μ „λ‹¬λ°›λ”λ‹¤.

5. **μμƒ λ²„νΌ μ²λ¦¬ λ° μ¶λ ¥:**
```python
try:
    buffer = b""
    while True:
        buffer += process.stdout.read(4096)
        a = buffer.find(b'\xff\xd8')
        b = buffer.find(b'\xff\xd9')

        if a != -1 and b != -1:
            jpg = buffer[a:b+2]
            buffer = buffer[b+2:]

            bgr_frame = cv2.imdecode(np.frombuffer(jpg, dtype=np.uint8), cv2.IMREAD_COLOR)

            if bgr_frame is not None:
                cv2.imshow('Camera Stream', bgr_frame)

                if cv2.waitKey(1) & 0xFF == ord('q'):
                    break
```
- `buffer` λ³€μμ— μ¤νΈλ¦¬λ°λ λ°μ΄ν„°λ¥Ό κ³„μ† μ¶”κ°€ν•λ‹¤.
- JPEG λ°μ΄ν„°μ μ‹μ‘(`\xff\xd8`)κ³Ό λ(`\xff\xd9`)μ„ μ°Ύμ•„μ„ μμƒμΌλ΅ λ³€ν™ν•λ‹¤.
- `cv2.imshow`λ¥Ό μ‚¬μ©ν•μ—¬ μμƒμ„ ν™”λ©΄μ— μ¶λ ¥ν•λ‹¤.
- ν‚¤λ³΄λ“μ—μ„ `q`λ¥Ό λ„λ¥΄λ©΄ μΆ…λ£λλ‹¤.

6. **ν”„λ΅μ„Έμ¤ μΆ…λ£ λ° μ°½ λ‹«κΈ°:**
```python
finally:
    process.terminate()
    cv2.destroyAllWindows()
```
- μ¤νΈλ¦¬λ° ν”„λ΅μ„Έμ¤λ¥Ό μ•μ „ν•κ² μΆ…λ£ν•κ³  λ¨λ“  OpenCV μ°½μ„ λ‹«λ”λ‹¤.

---

### 2-3. μ½”λ“ μ‹¤ν–‰ λ°©λ²•
μ½”λ“λ¥Ό νμ΄μ¬ νμΌλ΅ μ €μ¥ν• ν›„, μ•„λ λ…λ Ήμ–΄λ΅ μ‹¤ν–‰ν•λ‹¤:

(ν„μ¬ μ„μΉλ¥Ό docsλΌ κ°€μ •)
```bash
python3 ../src/camera/pi_libcamera/camera-test.py
```

μΉ΄λ©”λΌ μ¤νΈλ¦¬λ° μ°½μ΄ μ •μƒμ μΌλ΅ μ¶λ ¥λλ©΄ μ„¤μ •μ΄ μ™„λ£λ κ²ƒμ΄λ‹¤.



---
